# 中国省际FDI影响因素回归分析


## 目录结构

```
Regression-Analysis-Final/
│
├── README.md                           # 本文档
│
├── 回归分析数据.xlsx                    # 原始数据文件
│
├── 00 数据处理.R                        # 数据读入与预处理
├── 01 描述性分析与可视化.R              # 数据的描述性统计与可视化
├── 02 多元线性回归.R                    # 基础OLS回归模型
├── 02.1 共线性问题（岭回归）.R          # 岭回归处理多重共线性
├── 02.2 惩罚项的变量选择.R              # Lasso/Elastic Net/SCAD/MCP
├── 02.3 逐步回归.R                      # 基于AIC/BIC/F检验的逐步回归
├── 03 主成分回归.R                      # 主成分分析与主成分回归
├── 04 构造新变量.R                      # 基于分组PCA构造综合指标
├── 05 分组PCA后差分回归.R               # 一阶差分模型与分地区回归
│
├── Document/                            # 结果文档
│   ├── 02 多元回归分析-结果.txt
│   ├── 03 主成分回归-结果.txt
│   └── 04 构造新变量回归-结果.txt
│
└── Figure/                              # 可视化图表输出文件夹
    ├── 1.1 变量分布直方图对比.png
    ├── 1.2 2021年分省FDI热力地图.png
    ├── 1.3 相关系数矩阵.png
    ├── 1.4 散点图矩阵.png
    ├── 3.1 主成分回归诊断图.png
    ├── 4.1 构造新变量PCA碎石图.png
    ├── 4.2 新变量回归诊断图.png
    ├── 4.3 新变量回归的自相关图.png
    ├── FDI 随时间变化（分区域）.png
    ├── Log(FDI) 随时间变化（分区域）.png
    └── heatmap_2021.png
```

---

## 数据文件说明

### 数据文件：`回归分析数据.xlsx`

**数据来源：** 国家统计局、各省统计年鉴、中国科技统计年鉴等

**数据范围：** 2013-2021年，31个省级行政单位（不含港澳台）

**变量说明：**

| 变量名     | 含义                            | 单位  |
| ---------- | ------------------------------- | ----- |
| `Province` | 省份名称                        | -     |
| `Year`     | 年份                            | -     |
| `Region`   | 地区分类（东部/中部/西部/东北） | -     |
| `FDI`      | 外商直接投资额（因变量）        | 亿元  |
| `GDP`      | 地区生产总值                    | 亿元  |
| `PGDP`     | 人均GDP                         | 元/人 |
| `TER_GDP`  | 第三产业占GDP比重               | %     |
| `APC`      | 社会消费品零售总额              | 亿元  |
| `WAGE`     | 城镇单位平均工资                | 元    |
| `PATENT`   | 发明专利授权数                  | 件    |
| `OPEN`     | 对外开放度（进出口总额/GDP）    | %     |
| `TRANS`    | 货运总量                        | 万吨  |
| `RD`       | R&D经费支出                     | 亿元  |
| `STHC`     | 理工科本科及以上学历人数        | 万人  |
| `STHC_ns`  | 理工科在校本科及研究生人数      | 万人  |
| `FDI_lag`  | 上一年FDI（用于部分分析）       | 亿元  |

---

## 代码文件说明

### 1. 数据处理模块

#### `00 数据处理.R`
**功能：** 数据读入、清洗、全局设置与回归诊断函数定义

**主要内容：**
1. **数据读入与预处理**
   - 读取Excel数据
   - 合并地区分类（将"中部"和"东北"合并）
   - 转换变量类型（因子型）

2. **全局审美设置**
   - 定义学术风格主题函数 `theme_academic()`
   - 设置配色方案（用于所有可视化）

3. **回归诊断工具函数**
   - `test_heteroscedasticity()`: Spearman秩相关检验异方差
   - `test_outliers()`: 异常值检测（删除学生化残差、Cook距离、杠杆值）
   - `test_vif()`: 方差膨胀因子检验多重共线性
   - `test_autocorrelation()`: Durbin-Watson检验自相关

**使用说明：**
- 这是所有其他脚本的**依赖文件**，其他脚本开头都会调用 `source("00 数据处理.R")`
- 定义了统一的数据对象 `df` 和 `df_raw`

---

### 2. 描述性分析模块

#### `01 描述性分析与可视化.R`
**功能：** 数据探索性分析与可视化

**主要内容：**
1. **变量分布分析**
   - 生成原始分布 vs 对数分布的对比直方图
   - 输出：`1.1 变量分布直方图对比.png`（2×3布局）

2. **地理分布可视化**
   - 绘制2021年各省FDI热力地图
   - 使用中国标准地图（含九段线）
   - 输出：`1.2 2021年分省FDI热力地图.png`

3. **相关性分析**
   - 计算自变量间的相关系数矩阵
   - 生成热力图（蓝-白-红配色）
   - 输出：`1.3 相关系数矩阵.png` `1.4 散点图矩阵.png`

---

### 3. 回归建模模块

#### `02 多元线性回归.R` 
**功能：** 基础OLS回归模型的建立与诊断

**主要内容：**
1. **模型设定**
   - 对因变量和大部分自变量进行对数变换（log-log模型）

2. **异常值处理**
   - 检测并删除Y方向异常值（2021年海南）

3. **模型诊断**
   - 异方差检验（Spearman秩相关）
   - 多重共线性检验（VIF）
   - 生成标准诊断图（4图）

---

#### `02.1 共线性问题（岭回归）.R`
**功能：** 使用岭回归处理多重共线性

**主要内容：**
1. **岭回归实现**
   - 交叉验证选择最优λ（`cv.glmnet`）
   - 计算岭回归的有效VIF

2. **对比分析**
   - OLS vs Ridge的系数对比
   - VIF对比（展示岭回归降低共线性的效果）
   - 拟合优度对比（R²、RMSE）

3. **结果输出**
   - 生成完整对比表格（包含系数、VIF、拟合指标）
---

#### `02.2 惩罚项的变量选择.R`
**功能：** 使用多种惩罚回归方法进行变量选择

**主要内容：**
1. **五种惩罚方法对比**
   - Ridge（α=0）：仅收缩，不选择
   - Lasso（α=1）：自动变量选择
   - Elastic Net：Ridge与Lasso的折中（自动搜索最优α）
   - SCAD：非凸惩罚，更强的Oracle性质
   - MCP：最小化极大凹惩罚

2. **交叉验证调参**
   - 所有方法均使用10折交叉验证
   - 选择最小化MSE的λ

3. **模型比较**
   - 输出各模型的MSE、R²、选择变量数

---

#### `02.3 逐步回归.R`
**功能：** 基于信息准则和假设检验的逐步回归

**主要内容：**
1. **三种逐步回归准则**
   - **AIC准则**：基于信息论
   - **BIC准则**：更严格的惩罚（k=log(n)）
   - **F检验（P值准则）**：进入p<0.05，剔除p>0.10

2. **全面对比**
   - 拟合效果对比（R²、调整R²、AIC、BIC、变量数）
   - 回归系数对比（展示各模型保留的变量及其系数）
   - VIF对比（评估多重共线性改善情况）

3. **结果输出**
   - 三个汇总表格：拟合效果、系数、VIF

---

### 4. 主成分回归模块

#### `03 主成分回归.R`
**功能：** 利用主成分分析降维后进行回归

**主要内容：**
1. **主成分分析**
   - 对11个数值变量进行标准化
   - 计算主成分（使用`psych`包的`principal`函数）
   - 输出方差贡献率表

2. **主成分选择**
   - Kaiser准则：保留特征值>1的主成分
   - 本研究保留了前3个主成分（累计贡献率约70%）

3. **主成分回归**
   - 公式：`log(FDI) ~ PC1 + PC2 + PC3 + Region`
   - 完整的回归诊断

4. **系数还原**
   - 将主成分系数还原为原始变量的系数
   - 输出标准化系数和原始系数

**输出：**
- 方差贡献率表
- 主成分回归结果
- 诊断图：`3.1 主成分回归诊断图.png`

---

### 5. 变量构造模块

#### `04 构造新变量.R`
**功能：** 基于分组PCA构造经济学意义明确的综合指标

**主要内容：**
1. **分组主成分分析**
   - **创新能级（Innovation_Power）**：PATENT + RD + STHC + STHC_ns
   - **市场联通度（Market_Scale）**：TRANS + OPEN
   - **经济质量（Econ_Quality）**：PGDP + APC + GDP
   - **产业结构（Ind_Structure）**：TER_GDP（标准化）
   - **劳动成本（Labor_Cost）**：WAGE（标准化）

2. **可视化**
   - 输出各组PCA的碎石图（展示第一主成分的方差贡献）
   - 输出：`4.1 构造新变量PCA碎石图.png`

3. **新变量回归**
   - 公式：`log(FDI) ~ Innovation_Power + Market_Scale + Econ_Quality + Ind_Structure + Labor_Cost + Region`
   - 完整的回归诊断

**输出：**
- `4.1 构造新变量PCA碎石图.png`
- `4.2 新变量回归诊断图.png`
- `4.3 新变量回归的自相关图.png`

---

#### `05 分组PCA后差分回归.R` 
**功能：** 处理面板数据的时间序列特征，进行差分回归

**主要内容：**
1. **一阶差分**
   - 对所有变量进行一阶差分（Δ变量_t = 变量_t - 变量_{t-1}）
   - 消除个体固定效应和时间趋势

2. **加权最小二乘（WLS）**
   - 使用残差平方的倒数作为权重
   - 处理异方差问题

3. **分地区回归**
   - 全样本回归（含东部、西部虚拟变量）
   - 分地区回归：东部、西部、中部+东北

4. **聚类稳健标准误**
   - 使用`fixest`包的`feols`函数
   - 按省份聚类（cluster by Province）

5. **诊断检验**
   - BP异方差检验
   - Durbin-Watson自相关检验
   - Spearman秩相关检验
   - 残差诊断图

**输出：**
- 四个模型的回归结果（全样本+三个分地区）
- 诊断统计量汇总表
- 诊断图（异方差图+自相关图）
